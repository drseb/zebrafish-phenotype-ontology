# Files in the src/curation directory

Most files in the src/curation directory are generated by the automated curation pipeline scripts in src/scripts. More information can be found in the respective README there. The following files are important to the automated curation process of ZFIN EQ annotations to ZP defined classes in OWL:

- id_map.tsv: This is the most important file part of the pipeline containing the stable mapping between EQ annotations and ZP identifiers.
- id_map.tsv_removed_incomplete.tsv: This file contains 134 ZP-EQ mappings that were previously constructed (by the old ZP pipeline), but do not have corresponding records in the current ZFIN EQ data. There is a choice whether to add those to the manually curated ZP classes. This file is used only for constructing the reserved_iri.txt, just in case (albeit unlikely), someone somewhere used the ZP classes in here for something.
- id_map.tsv_removed_ambiguous.tsv: These are 138 mappings involving a total of 74 ZP ids that were used in previous versions of the ZP, but are now excluded because their mapping to ZFIN EQs was ambiguous. EQs in ZFIN that were mapped that way now have new ids. However, just to be safe, it makes sense to try and avoid re-using the 74 ZP ids in this file -> they should be (and are) added to reserved_iris.txt before any automatic curation task is run.
- deprecated_id_map.tsv: This file documents those ZP to ZFIN EQ mappings that could be found one day, but not anymore. It can be safely ignored; Mappings in this file are NOT excluded from the main mapping file, as the assumption is that once an ZFIN EQ mapping was made in the past, it constitutes a valid precomposed ZP class. However, this file can be reviewed from time to time to see whether any classes need to be manually deprecated. This file is re-created whenever the pipeline is run and has no function other than documentation.
- kb_zp.ttl: ZFIN gene annotations ([phenoGeneCleanData_fish.txt](https://zfin.org/downloads/phenoGeneCleanData_fish.txt)) as RDF with reference to ZP identifiers. This file can be loaded alongside ZP into the Protege to query the associations between the gene annotations and the ZP classes easily (Example: give me all annotations to a heart phenotype). 
- zp_zfin_phenoGeneCleanData_fish: The same as kb_zp.ttl, as TSV. This is a copy of ZFINs [phenoGeneCleanData_fish.txt](https://zfin.org/downloads/phenoGeneCleanData_fish.txt) with two additional columns (the stable ZFIN-EQ id and the ZP identifier).
- reserved_iris.txt: This file is not up-to-date and MUST be regenerated every time before the pipeline is run. It contains all the ZP ids used across the various pipelines of the ZP, and is used as an input to pipelines to make sure no ID is generated twice.
- pattern_assignments.tsv: This file contains the mapping of ZP ids to their corresponding ZFIN base pattern. This file is not used anywhere and is there purely for documentation/reference purposes (generated by zp_dosdp.py).
- zp_zfin_phenotype_fish.tsv: A table that contains the ZFIN fish-phenotype data with reference to their corresponding ZP classes.
- zp_pipeline.sh: The bash script that executes the ZFIN-EQ to ZP pattern pipeline. The pipeline is documented below. 
- make.reservediris: A makefile containing the recipe for constructing the reserved_iris file and the anatomy seed for the automated ZFA -> ZP pipeline.
- make.patterniris: A makefile containing goals for adding IRIs to manually curated phenotype classes.
- terms.txt: files with the ending *terms.txt* are created by the reserved_iris.txt pipeline and can be ignored. They are re-created during everything execution of the pipeline (and should perhaps be deleted afterwards to avoid confusion?)
- editseed.txt: all ZP classes currently referenced by the zp-edit.owl file. Can be savely ignored. 


# The pipeline comprises the following components:

* Updating the ZFIN-EQ to ZP ID map
* Mapping ZFIN-EQs to DOSDP patterns
* Identifying unsatisfiable classes and removing them from the pipeline

The pipeline can be executed by:
* In your terminal, navigate to `zebrafish-phenotype-ontology/src/curation`
* Run `sh zp_pipeline.sh`. This script runs the following make commands:
  * `# python3 ../scripts/zp_annotation_to_id_map.py id_map.tsv` <----- THIS IS TO INITIALISE ZP FROM SCRATCH. DO NOT UNCOMMENT UNLESS YOU WANT TO BREAK CURRENT ZP (this part of the pipeline is commented in the python script in detail)
  * make reserved_iris.txt
  * `python3 ../scripts/zp_update_id_map.py id_map.tsv deprecated_id_map.tsv reserved_iris.txt 100000`: Updating the ZFIN-EQ to ZP mapping
  * `python3 ../scripts/zp_dosdp.py id_map.tsv ../patterns/data/auto pattern_assignments.txt`: Mapping the ZFIN-EQ to DOSDP patterns 
  * `python3 ../scripts/zp_kb.py id_map.tsv zp_annotations_to_iri.tsv kb_zp.ttl`: Dumping an RDF version of the ZFIN phenotype annotations which allows browsing the actual annotations in Protege. This is particularly interesting for semantic search (show me all annotations to phenotypes affecting the morphology of a part of the head).

After this pipeline is run, the 


# Updating the ODK

* Run `docker pull obolibrary/odkfull` to make sure you have the latest version of the ODK installed
* Git clone the [ontology-development-kit](https://github.com/INCATools/ontology-development-kit/) source code on GitHub, or, if you already have it, make sure it is up to date (git pull)
* go to the ontology-development-kit source code directory in terminal (cd ..).
* Make sure you have an up to date ODK configuration file for ZP. You can find it src/metadata/zp-odk.yaml (ZP directory, not ODK). Copy it to the examples directory of the ODK repository
* Run `./seed-via-docker.sh -c -C examples/phenotype-ontologies/zp-odk.yaml`
* Copy the file you can find under target/zp/src/ontology/Makefile to the respective location src/ontology/Makefile in your ZP directory
